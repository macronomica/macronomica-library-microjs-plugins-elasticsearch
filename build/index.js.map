{"version":3,"sources":["../src/index.js"],"names":["settings","micro","name","pluginId","plugin","id","__client","__actions","queue","case","args","done","Promise","resolve","middleware","client","actions"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;kBAEe,UAACA,QAAD;AAAA,SAAc,UAACC,KAAD,EAAQC,IAAR,EAAcC,QAAd,EAA2B;AACtD,QAAMC,SAAS,EAAEF,UAAF,EAAQG,IAAIF,QAAZ,EAAf;AACA,QAAIG,iBAAJ;AACA,QAAIC,YAAY,EAAhB;;AAEAN,UACGO,KADH,CACS;AACLC,YAAM,MADD;AAELC,YAAM,EAFD;AAGLC,YAAM;AAAA,eAAM,IAAIC,OAAJ,CAAY,mBAAW;AACjCN,qBAAW,uBAAQN,QAAR,CAAX;AACAO,sBAAY,uBAAQN,KAAR,EAAeG,MAAf,EAAuBE,QAAvB,CAAZ;AACAO;AACD,SAJW,CAAN;AAAA;AAHD,KADT,EAUGL,KAVH,CAUS;AACLC,YAAM,OADD;AAELC,YAAM,EAFD;AAGLC,YAAM;AAAA,eAAM,IAAIC,OAAJ,CAAY,mBAAW;AACjC,cAAI,CAAC,CAACN,QAAN,EAAgB;AACdC,wBAAY,IAAZ;AACAD,uBAAW,IAAX;AACD;;AAEDO;AACD,SAPW,CAAN;AAAA;AAHD,KAVT;;AAuBA,WAAO;AACLC,yCADK;AAELC,YAFK,oBAEI;AAAE,eAAOT,QAAP;AAAiB,OAFvB;AAGLU,aAHK,qBAGK;AAAE,eAAOT,SAAP;AAAkB;AAHzB,KAAP;AAKD,GAjCc;AAAA,C","file":"index.js","sourcesContent":["import middleware from 'elasticsearch';\nimport connect from './connect';\nimport actions from './actions';\n\nexport default (settings) => (micro, name, pluginId) => {\n  const plugin = { name, id: pluginId };\n  let __client;\n  let __actions = {};\n\n  micro\n    .queue({\n      case: 'wait',\n      args: [],\n      done: () => new Promise(resolve => {\n        __client = connect(settings);\n        __actions = actions(micro, plugin, __client);\n        resolve();\n      })\n    })\n    .queue({\n      case: 'close',\n      args: [],\n      done: () => new Promise(resolve => {\n        if (!!__client) {\n          __actions = null;\n          __client = null;\n        }\n\n        resolve();\n      })\n    });\n\n  return {\n    middleware,\n    client() { return __client },\n    actions() { return __actions },\n  }\n}"]}