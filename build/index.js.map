{"version":3,"sources":["../src/index.js"],"names":["settings","micro","name","pluginId","plugin","id","__client","__actions","queue","case","args","done","then","client","Promise","logger","info","resolve","middleware","actions"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;kBAEe,UAACA,QAAD;AAAA,SAAc,UAACC,KAAD,EAAQC,IAAR,EAAcC,QAAd,EAA2B;AACtD,QAAMC,SAAS,EAAEF,UAAF,EAAQG,IAAIF,QAAZ,EAAf;AACA,QAAIG,iBAAJ;AACA,QAAIC,YAAY,EAAhB;;AAEAN,UACGO,KADH,CACS;AACLC,YAAM,MADD;AAELC,YAAM,EAFD;AAGLC,YAAM;AAAA,eAAM,uBAAQV,KAAR,EAAeG,MAAf,EAAuBJ,QAAvB,EACTY,IADS,CACJ,kBAAU;AACdL,sBAAY,uBAAQN,KAAR,EAAeG,MAAf,EAAuBE,WAAWO,MAAlC,CAAZ;AACA,iBAAOA,MAAP;AACD,SAJS,CAAN;AAAA;AAHD,KADT,EAUGL,KAVH,CAUS;AACLC,YAAM,OADD;AAELC,YAAM,EAFD;AAGLC,YAAM;AAAA,eAAM,IAAIG,OAAJ,CAAY,mBAAW;AACjC,cAAI,CAAC,CAACR,QAAN,EAAgB;AACdC,wBAAY,IAAZ;AACAD,uBAAW,IAAX;AACD;;AAEDL,gBAAMc,MAAN,CAAaC,IAAb,mJAA2D;AACzDX,gBAAID,OAAOC;AAD8C,WAA3D;;AAIAY;AACD,SAXW,CAAN;AAAA;AAHD,KAVT;;AA2BA,WAAO;AACLC,yCADK;AAELL,YAFK,oBAEI;AAAE,eAAOP,QAAP;AAAiB,OAFvB;AAGLa,aAHK,qBAGK;AAAE,eAAOZ,SAAP;AAAkB;AAHzB,KAAP;AAKD,GArCc;AAAA,C","file":"index.js","sourcesContent":["import middleware from 'elasticsearch';\nimport connect from './connect';\nimport actions from './actions';\n\nexport default (settings) => (micro, name, pluginId) => {\n  const plugin = { name, id: pluginId };\n  let __client;\n  let __actions = {};\n\n  micro\n    .queue({\n      case: 'wait',\n      args: [],\n      done: () => connect(micro, plugin, settings)\n        .then(client => {\n          __actions = actions(micro, plugin, __client = client);\n          return client;\n        })\n    })\n    .queue({\n      case: 'close',\n      args: [],\n      done: () => new Promise(resolve => {\n        if (!!__client) {\n          __actions = null;\n          __client = null;\n        }\n\n        micro.logger.info(`Подключение к ElasticSearch разорвано`, {\n          id: plugin.id\n        });\n\n        resolve();\n      })\n    });\n\n  return {\n    middleware,\n    client() { return __client },\n    actions() { return __actions },\n  }\n}"]}